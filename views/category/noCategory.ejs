<h1>No Category</h1>
<p>Assign items to their respected categories in order to edit their content.</p>
<div class="items-grid" style="padding: 0px 14px;">
  <p>Name</p>
  <p>Price</p>
  <p>Available</p>
  <p style="margin-left: auto;">Select a Category</p>
</div>
<ul class="list">
  <% items.forEach(item => { %>
      <li class="items-grid">
        <p><%= item.name %></p>
        <p><%= item.price %></p>
        <p><%= item.quantity %></p>
        <form action="/item/move/<%= item.id %>" method="post" style="margin-left: auto;">
          <%- include('../errors', { errors }); %>
          <div class="dropdown">
            <input type="hidden" name="catId" id="catId">
            <input  name="category" id="myInput" type="text" oninput="filterCategories()"
              placeholder="Search.." autocomplete="off">
            <ul class="search-list"></ul>  
            <button type="submit">Add Category</button>
          </div>
        </form>
      </li>
  <% }) %>
</ul>
<script>
  const categories = <%- JSON.stringify(categories) %>;
  const list = document.querySelector('.search-list');
  document.querySelector('form').addEventListener('submit', (e) => {
    const catId = document.querySelector('#catId');
    if (!catId.value && list.childElementCount > 0) {
      catId.value = 'missing click';
    }
  });
  const appendCategories = (filtered) => {
    filtered.forEach(category => {
      const li = document.createElement('li');
      li.textContent = category.name;
      li.addEventListener('click', () => {
        document.getElementById('myInput').value = category.name;
        document.getElementById('catId').value = category.id;
        list.innerHTML = '';
      })
      list.appendChild(li);
    });
  };
  const filterCategories = () => {
    const searchInput = document.getElementById('myInput').value.toLowerCase();
    document.getElementById('catId').value = '';
    if (searchInput === '') return list.innerHTML = '';
    const filtered = categories.filter(category => category.name.toLowerCase().includes(searchInput));
    list.innerHTML = '';
    if (filtered.length === 0) {
      const li = document.createElement('li');
      li.textContent = 'No category exists, create a new one';
      list.appendChild(li);
      return;
    }
    appendCategories(filtered);
  };
</script>